{
  "openapi": "3.0.3",
  "info": {
  "title": "LeafLock API",
    "version": "1.0.0"
  },
  "servers": [
    { "url": "/" }
  ],
  "paths": {
    "/api/v1/health": {
      "get": {
        "summary": "Health check",
        "responses": {
          "200": {"description": "OK"}
        }
      }
    },
    "/api/v1/auth/register": {
      "post": {
        "summary": "Register user",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {"$ref": "#/components/schemas/RegisterRequest"}
            }
          }
        },
        "responses": {
          "201": {"description": "Created", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/RegisterResponse"}, "examples": {"success": {"summary": "Successful registration", "value": {"message": "Registration successful", "token": "<jwt>", "user_id": "11111111-1111-1111-1111-111111111111", "workspace_id": "22222222-2222-2222-2222-222222222222"}}}}}},
          "400": {"description": "Invalid request"},
          "409": {"description": "Duplicate email"}
        }
      }
    },
    "/api/v1/notes": {
      "get": {
        "summary": "List notes",
        "security": [{"bearerAuth": []}],
        "responses": {
          "200": {"description": "OK", "content": {"application/json": {"schema": {"$ref": "#/components/schemas/NoteListResponse"}, "examples": {"empty": {"summary": "No notes yet", "value": {"notes": []}}, "one": {"summary": "Single note", "value": {"notes": [{"id": "33333333-3333-3333-3333-333333333333", "title": "Welcome", "content": "Hello World", "created_at": "2025-01-01T00:00:00Z", "updated_at": "2025-01-01T00:00:00Z"}]}}}}}},
          "401": {"description": "Unauthorized"}
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "RegisterRequest": {
        "type": "object",
        "properties": {
          "email": {"type": "string", "format": "email"},
          "password": {"type": "string", "format": "password", "minLength": 12}
        },
        "required": ["email", "password"]
      },
      "RegisterResponse": {
        "type": "object",
        "properties": {
          "message": {"type": "string"},
          "token": {"type": "string"},
          "user_id": {"type": "string", "format": "uuid"},
          "workspace_id": {"type": "string", "format": "uuid"}
        }
      },
      "Note": {
        "type": "object",
        "properties": {
          "id": {"type": "string", "format": "uuid"},
          "title": {"type": "string"},
          "content": {"type": "string"},
          "created_at": {"type": "string", "format": "date-time"},
          "updated_at": {"type": "string", "format": "date-time"}
        }
      },
      "NoteListResponse": {
        "type": "object",
        "properties": {
          "notes": {
            "type": "array", "items": {"$ref": "#/components/schemas/Note"}
          }
        }
      }
    }
  }
}
    "/api/v1/docs/openapi.json": {
      "get": {
        "summary": "OpenAPI specification (admin-only)",
        "security": [{"bearerAuth": []}],
        "responses": {"200": {"description": "Spec JSON", "content": {"application/json": {}}}, "401": {"description":"Unauthorized"}, "403": {"description":"Forbidden"}}
      }
    },
    "/api/v1/admin/health": {
      "get": {
        "summary": "Admin API health",
        "security": [{"bearerAuth": []}],
        "responses": {"200": {"description": "OK", "content": {"application/json": {"examples": {"ok": {"value": {"status": "ok"}}}}}}, "401": {"description":"Unauthorized"}, "403": {"description":"Forbidden"}}
      }
    },
    "/api/v1/admin/users/{id}/admin": {
      "put": {
        "summary": "Toggle admin flag",
        "security": [{"bearerAuth": []}],
        "parameters": [
          {"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"}}
        ],
        "requestBody": {
          "required": true,
          "content": {"application/json": {"schema": {"type":"object","properties": {"admin": {"type":"boolean"}},"required":["admin"]}}}
        },
        "responses": {"200": {"description": "OK", "content": {"application/json": {"examples": {"ok": {"value": {"ok": true}}}}}}, "401": {"description":"Unauthorized"}, "403": {"description":"Forbidden"}}
      }
    },
    "/api/v1/admin/roles": {
      "get": {
        "summary": "List all roles",
        "security": [{"bearerAuth": []}],
        "responses": {"200": {"description":"OK", "content": {"application/json": {"examples": {"roles": {"value": {"roles": ["admin", "user", "moderator", "auditor"]}}}}}}, "401": {"description":"Unauthorized"}, "403": {"description":"Forbidden"}}
      }
    },
    "/api/v1/admin/users/{id}/roles": {
      "get": {
        "summary": "List user roles",
        "security": [{"bearerAuth": []}],
        "parameters": [{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"}}],
        "responses": {"200": {"description":"OK"}, "401": {"description":"Unauthorized"}, "403": {"description":"Forbidden"}}
      },
      "post": {
        "summary": "Assign role to user",
        "security": [{"bearerAuth": []}],
        "parameters": [{"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"}}],
        "requestBody": {"required": true, "content": {"application/json": {"schema": {"type":"object","properties": {"role": {"type":"string"}},"required":["role"]}}}},
        "responses": {"200": {"description":"OK", "content": {"application/json": {"examples": {"ok": {"value": {"ok": true}}}}}}, "401": {"description":"Unauthorized"}, "403": {"description":"Forbidden"}, "404": {"description":"Role not found"}}
      }
    },
    "/api/v1/admin/users/{id}/roles/{role}": {
      "delete": {
        "summary": "Remove role from user",
        "security": [{"bearerAuth": []}],
        "parameters": [
          {"name":"id","in":"path","required":true,"schema":{"type":"string","format":"uuid"}},
          {"name":"role","in":"path","required":true,"schema":{"type":"string"}}
        ],
        "responses": {"200": {"description":"OK", "content": {"application/json": {"examples": {"ok": {"value": {"ok": true}}}}}}, "401": {"description":"Unauthorized"}, "403": {"description":"Forbidden"}, "404": {"description":"Role not found"}}
      }
    }
