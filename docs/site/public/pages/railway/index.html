<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LeafLock Documentation</title>
    <link rel="stylesheet" href="/css/main.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="brand" href="/">LeafLock</a>
        <nav>
          <ul>
            
              <li><a href="/pages/">Documentation</a></li>
            
              <li><a href="https://github.com/RelativeSure/LeafLock">Repository</a></li>
            
          </ul>
        </nav>
      </div>
    </header>
    <main class="container">
      
  <article class="content">
    <h1></h1>
    
    <div class="meta">
      <span>Last updated: 2025-09-14</span>
    </div>
    <div class="markdown">
      <h1 id="deploy-leaflock-on-railway">Deploy LeafLock on Railway</h1>
<p>This repo is ready to deploy on Railway as two services: Backend (Go) and Frontend (Vite + Nginx). Below are recommended setups for a simple production deployment.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Railway account and the Railway CLI installed (<code>npm i -g @railway/cli</code>)</li>
<li>A Railway project created (via the UI or CLI)</li>
</ul>
<h2 id="services">Services</h2>
<h3 id="1-backend-service-go">1) Backend Service (Go)</h3>
<ul>
<li>Root: <code>backend/</code></li>
<li>Build: Dockerfile (already present)</li>
<li>Port: set env var <code>PORT</code> (Railway sets this automatically)</li>
<li>Required environment variables:
<ul>
<li><code>JWT_SECRET</code> (64+ random bytes)</li>
<li><code>SERVER_ENCRYPTION_KEY</code> (32 random bytes)</li>
<li><code>DATABASE_URL</code> (Provision Railway Postgres; variable auto-populates)</li>
<li><code>REDIS_URL</code> (Provision Railway Redis; variable auto-populates)</li>
<li><code>REDIS_PASSWORD</code> (from Redis plugin)</li>
<li><code>ENABLE_REGISTRATION</code> (set to <code>false</code> to disable public sign-ups in production)</li>
<li>Optional: <code>CORS_ORIGINS</code> (comma‚Äëseparated allowed origins, e.g. <code>https://leaflock.app,https://&lt;frontend-subdomain&gt;.up.railway.app</code>)</li>
</ul>
</li>
</ul>
<h3 id="2-frontend-service-vite--nginx">2) Frontend Service (Vite + Nginx)</h3>
<ul>
<li>Root: <code>frontend/</code></li>
<li>Build: Dockerfile (already present)</li>
<li>Port: Nginx listens on <code>$PORT</code> (templated at runtime)</li>
<li>Required env vars:
<ul>
<li><code>VITE_API_URL</code> (Backend public URL, e.g. <code>https://&lt;backend-subdomain&gt;.up.railway.app</code>)</li>
<li>Optional: <code>VITE_ENABLE_ADMIN_PANEL</code> (<code>true|false</code>)</li>
</ul>
</li>
</ul>
<h2 id="steps-ui">Steps (UI)</h2>
<ol>
<li>Create a new Railway project.</li>
<li>‚ÄúNew Service‚Äù ‚Üí ‚ÄúDeploy from repo‚Äù ‚Üí select this repo.</li>
<li>Create Backend service:
<ul>
<li>Select <code>backend/</code> as the service root.</li>
<li>Keep Dockerfile.</li>
<li>Add Railway Postgres and Redis plugins; they will set <code>DATABASE_URL</code>, <code>REDIS_URL</code>, <code>REDIS_PASSWORD</code> automatically.</li>
<li>Add <code>JWT_SECRET</code> and <code>SERVER_ENCRYPTION_KEY</code> secrets.</li>
</ul>
</li>
<li>Create Frontend service:
<ul>
<li>Select <code>frontend/</code> as the service root; keep Dockerfile.</li>
<li>Set <code>VITE_API_URL</code> to the Backend‚Äôs public URL.</li>
</ul>
</li>
<li>For both services, enable a custom domain or use the provided <code>*.up.railway.app</code> domain.</li>
</ol>
<h2 id="steps-cli">Steps (CLI)</h2>
<pre tabindex="0"><code># Login and link project
railway login
railway link

# Create services (do once per service)
railway service:create backend
railway service:create frontend

# Set service roots
railway service backend
railway up --service backend --root backend
railway service frontend
railway up --service frontend --root frontend

# Set variables (examples)
railway variables set JWT_SECRET=$(openssl rand -base64 64)
railway variables set SERVER_ENCRYPTION_KEY=$(openssl rand -base64 32)
railway variables set VITE_API_URL=https://&lt;backend&gt;.up.railway.app
# Optional: lock registration in production
railway variables set ENABLE_REGISTRATION=false
</code></pre><p>Or run the helper script to bootstrap everything (requires logged-in CLI):</p>
<pre tabindex="0"><code>bash scripts/railway-setup.sh

# Or using the root helper CLI
./leaflock.sh railway
</code></pre><h2 id="deploy-from-github-manual">Deploy from GitHub (Manual)</h2>
<p>You can deploy to Railway from a manual GitHub Action run:</p>
<ol>
<li>Go to Actions ‚Üí ‚ÄúüöÑ Railway Deploy (Manual)‚Äù</li>
<li>Click ‚ÄúRun workflow‚Äù and choose target: backend | frontend | both</li>
<li>Ensure repo secret <code>RAILWAY_TOKEN</code> is set (Railway account ‚Üí Tokens)</li>
<li>Optionally set <code>vite_enable_admin_panel</code> and <code>enable_registration</code></li>
</ol>
<p>This workflow only runs when manually triggered (workflow_dispatch); it does not run on push.</p>
<p>Required GitHub Secrets</p>
<ul>
<li>RAILWAY_TOKEN (use a Project Token from Railway ‚Üí Project ‚Üí Settings ‚Üí Tokens, NOT an account token)</li>
<li>Optional: RAILWAY_PROJECT_ID (Project ‚Üí Settings ‚Üí Developer ‚Üí Project ID) ‚Äî not required if your token is a Project Token</li>
</ul>
<p>Alternatively, you can pass the <code>project_id</code> when clicking ‚ÄúRun workflow‚Äù.</p>
<h2 id="using-railpacknixpacks-no-docker">Using Railpack/Nixpacks (no Docker)</h2>
<p>If you prefer Railway‚Äôs default builders, create two services from this repo and set explicit build/start commands.</p>
<h3 id="backend-go">Backend (Go)</h3>
<ul>
<li>Service root: <code>backend/</code></li>
<li>Builder: Nixpacks (or Railpack)</li>
<li>Commands
<ul>
<li>Install: (leave blank)</li>
<li>Build: <code>go build -o app .</code></li>
<li>Start: <code>./app</code></li>
</ul>
</li>
<li>Environment variables
<ul>
<li>Provided by plugins: <code>DATABASE_URL</code>, <code>REDIS_URL</code>, <code>REDIS_PASSWORD</code></li>
<li>Set manually:
<ul>
<li><code>JWT_SECRET</code>: 64‚Äëbyte base64 random (see below)</li>
<li><code>SERVER_ENCRYPTION_KEY</code>: 32‚Äëbyte base64 random (see below)</li>
<li><code>ENABLE_REGISTRATION</code>: <code>false</code> (recommended for prod; toggle in Admin)</li>
<li><code>CORS_ORIGINS</code>: include your frontend domain(s), e.g. <code>https://leaflock.app,https://&lt;frontend&gt;.up.railway.app</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="frontend-vite--react">Frontend (Vite + React)</h3>
<ul>
<li>Service root: <code>frontend/</code></li>
<li>Builder: Nixpacks (or Railpack)</li>
<li>Commands (serve built assets via Vite preview)
<ul>
<li>Install: <code>corepack enable &amp;&amp; pnpm i --frozen-lockfile</code></li>
<li>Build: <code>pnpm build</code></li>
<li>Start: <code>pnpm preview --host 0.0.0.0 --port $PORT</code></li>
</ul>
</li>
<li>Environment variables
<ul>
<li><code>VITE_API_URL</code>: <code>https://&lt;your-backend&gt;.up.railway.app</code></li>
<li><code>VITE_ENABLE_ADMIN_PANEL</code>: <code>true</code> (optional)</li>
</ul>
</li>
</ul>
<p>Notes</p>
<ul>
<li>Do not deploy the repo root as a single service. Always set the root to <code>backend/</code> and <code>frontend/</code> respectively.</li>
<li>Using Vite preview avoids needing Nginx; it binds to <code>$PORT</code> directly.</li>
<li>If you attach a custom frontend domain, add it to backend <code>CORS_ORIGINS</code>.</li>
</ul>
<h3 id="deploy-button-template">Deploy Button (Template)</h3>
<p>You can also use Railway&rsquo;s deploy button to start from this repository template. You may still need to adjust service roots (backend/, frontend/) in the Railway UI after creation.</p>
<p><a href="https://railway.app/template/new?template=https://github.com/RelativeSure/notes&amp;plugins=postgresql,redis&amp;envs=JWT_SECRET,SERVER_ENCRYPTION_KEY,ENABLE_REGISTRATION,VITE_API_URL"><img src="https://railway.app/button.svg" alt="Deploy on Railway"></a></p>
<h2 id="notes">Notes</h2>
<ul>
<li>Backend already binds to <code>$PORT</code> (default 8080). Frontend Nginx now binds to <code>$PORT</code> using a templated nginx config.</li>
<li>For production, set <code>CORS_ORIGINS</code> on backend to include your frontend domain(s).</li>
<li>You can run both services under one project or separate them into two projects.</li>
</ul>

    </div>
  </article>

    </main>
    <footer class="site-footer">
  <div class="container">
    <div class="footer-links">
      <div>
        <h2>LeafLock Docs</h2>
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/pages/">Documentation Index</a></li>
        </ul>
      </div>
      <div>
        <h2>Legal</h2>
        <ul>
          
            <li>
              <a href="/pages/privacy/">Privacy</a>
            </li>
          
            <li>
              <a href="/pages/gdpr/">GDPR</a>
            </li>
          
            <li>
              <a href="/pages/license/">License</a>
            </li>
          
            <li>
              <a href="/pages/terms/">Terms</a>
            </li>
          
            <li>
              <a href="/pages/compliance/">Compliance</a>
            </li>
          
        </ul>
      </div>
      <div>
        <h2>Contact</h2>
        <ul>
          <li><a href="mailto:contact@leaflock.app">contact@leaflock.app</a></li>
        </ul>
      </div>
    </div>
    <p class="footer-note">&copy; 2025 LeafLock. All rights reserved.</p>
  </div>
</footer>

  </body>
</html>
