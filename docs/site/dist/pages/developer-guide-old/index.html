<!DOCTYPE html><html lang="en" class="scroll-smooth"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Developer Guide</title><meta name="description" content="Technical documentation for developers working with LeafLock."><link rel="icon" type="image/svg+xml" href="/favicon.svg"><!-- Preload fonts --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet"><!-- Open Graph --><meta property="og:title" content="Developer Guide"><meta property="og:description" content="Technical documentation for developers working with LeafLock."><meta property="og:type" content="website"><meta property="og:site_name" content="LeafLock Documentation"><!-- Twitter Card --><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Developer Guide"><meta name="twitter:description" content="Technical documentation for developers working with LeafLock."><link rel="stylesheet" href="/assets/index.sIBFf60m.css"></head> <body class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-emerald-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 font-['Inter'] transition-all duration-300"> <!-- Header with gradient background --> <header class="sticky top-0 z-50 bg-white/80 dark:bg-slate-900/80 backdrop-blur-lg border-b border-slate-200 dark:border-slate-700 shadow-sm"> <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"> <div class="flex items-center justify-between h-16"> <!-- Logo --> <a href="/" class="flex items-center space-x-3 hover:scale-105 transition-transform duration-200"> <div class="w-8 h-8 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-lg flex items-center justify-center shadow-lg"> <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path> </svg> </div> <span class="text-xl font-bold bg-gradient-to-r from-emerald-600 to-emerald-500 bg-clip-text text-transparent">
LeafLock
</span> </a> <!-- Navigation --> <nav class="hidden md:flex items-center space-x-8"> <a href="/pages/" class="text-slate-700 dark:text-slate-300 hover:text-emerald-600 dark:hover:text-emerald-400 font-medium transition-colors duration-200">
Documentation
</a> <a href="https://github.com/RelativeSure/LeafLock" target="_blank" class="flex items-center space-x-2 text-slate-700 dark:text-slate-300 hover:text-emerald-600 dark:hover:text-emerald-400 font-medium transition-colors duration-200"> <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"> <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path> </svg> <span>Repository</span> </a> </nav> <!-- Mobile menu button --> <button class="md:hidden p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors duration-200" id="mobile-menu-button"> <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path> </svg> </button> </div> </div> <!-- Mobile menu --> <div class="md:hidden hidden" id="mobile-menu"> <div class="px-4 py-2 space-y-2 bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-700"> <a href="/pages/" class="block px-3 py-2 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-emerald-50 dark:hover:bg-emerald-900/50 transition-colors duration-200">
Documentation
</a> <a href="https://github.com/RelativeSure/LeafLock" target="_blank" class="block px-3 py-2 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-emerald-50 dark:hover:bg-emerald-900/50 transition-colors duration-200">
Repository
</a> </div> </div> </header> <main class="min-h-screen">  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12"> <!-- Header section with gradient --> <div class="mb-12"> <div class="bg-gradient-to-br from-emerald-50 via-blue-50 to-violet-50 dark:from-slate-800 dark:via-slate-800 dark:to-emerald-900/20 rounded-2xl p-8 shadow-lg border border-slate-200 dark:border-slate-700"> <h1 class="text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-emerald-600 via-blue-600 to-violet-600 bg-clip-text text-transparent"> Developer Guide </h1> <p class="text-lg text-slate-600 dark:text-slate-300 mb-6 leading-relaxed"> Technical documentation for developers working with LeafLock. </p> <!-- Metadata section --> <div class="flex flex-wrap items-center gap-4 text-sm"> <div class="flex items-center space-x-2 text-slate-500 dark:text-slate-400"> <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path> </svg> <span>Updated 2025-09-19</span> </div> <div class="flex items-center space-x-2"> <svg class="w-4 h-4 text-slate-500 dark:text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path> </svg> <div class="flex flex-wrap gap-2"> <a href="/categories/development/" class="px-3 py-1 bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-300 rounded-full text-xs font-medium hover:bg-blue-200 dark:hover:bg-blue-900/70 transition-colors duration-200"> Development </a> </div> </div> </div> <div class="flex flex-wrap gap-2 mt-4"> <a href="/tags/api/" class="px-3 py-1 bg-emerald-100 dark:bg-emerald-900/50 text-emerald-800 dark:text-emerald-300 rounded-full text-xs font-medium hover:bg-emerald-200 dark:hover:bg-emerald-900/70 transition-colors duration-200 border border-emerald-200 dark:border-emerald-700">
#api </a><a href="/tags/swagger/" class="px-3 py-1 bg-emerald-100 dark:bg-emerald-900/50 text-emerald-800 dark:text-emerald-300 rounded-full text-xs font-medium hover:bg-emerald-200 dark:hover:bg-emerald-900/70 transition-colors duration-200 border border-emerald-200 dark:border-emerald-700">
#swagger </a><a href="/tags/rbac/" class="px-3 py-1 bg-emerald-100 dark:bg-emerald-900/50 text-emerald-800 dark:text-emerald-300 rounded-full text-xs font-medium hover:bg-emerald-200 dark:hover:bg-emerald-900/70 transition-colors duration-200 border border-emerald-200 dark:border-emerald-700">
#rbac </a><a href="/tags/testing/" class="px-3 py-1 bg-emerald-100 dark:bg-emerald-900/50 text-emerald-800 dark:text-emerald-300 rounded-full text-xs font-medium hover:bg-emerald-200 dark:hover:bg-emerald-900/70 transition-colors duration-200 border border-emerald-200 dark:border-emerald-700">
#testing </a><a href="/tags/scripts/" class="px-3 py-1 bg-emerald-100 dark:bg-emerald-900/50 text-emerald-800 dark:text-emerald-300 rounded-full text-xs font-medium hover:bg-emerald-200 dark:hover:bg-emerald-900/70 transition-colors duration-200 border border-emerald-200 dark:border-emerald-700">
#scripts </a> </div> </div> </div> <!-- Content section --> <article class="prose prose-lg prose-slate dark:prose-invert max-w-none"> <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg border border-slate-200 dark:border-slate-700 p-8">  <p><em>Last updated: 2025-09-19</em></p>
## Overview

This guide provides technical information for developers working with LeafLock, including API documentation, testing, scripts, and development workflows.

## API Documentation (Swagger)

Admin-only Swagger API documentation is available at:
- **UI**: `/api/v1/docs`
- **Spec**: `/api/v1/docs/openapi.json`

All endpoints are documented in `backend/docs/openapi.json`.

### Authentication
- Add a JWT bearer token (from `/auth/register` or `/auth/login`)
- Access requires `admin` role

### Testing Locally
- Bootstrap by setting `ADMIN_USER_IDS=<your-user-id>` and restart backend
- Open the UI and try the admin endpoints

### Contributing to the Spec
- Update `backend/docs/openapi.json` and include:
  - Request/response schemas in `components.schemas`
  - Examples in `responses[*].content[*].examples`
  - Security requirements as needed

## Role-Based Access Control (RBAC)

### Roles
- **admin**: Full access to admin APIs and Swagger docs
- **moderator**: Reserved for future moderation actions
- **auditor**: Read-only reports in future
- **user**: Default role for every user

Roles are stored in tables `roles` and `user_roles`. Users also have a boolean `is_admin` for quick admin flag checking.

### Admin APIs
- `GET /api/v1/admin/health`
- `PUT /api/v1/admin/users/:id/admin` `{ &quot;admin&quot;: true|false }`
- `GET /api/v1/admin/roles`
- `GET /api/v1/admin/users/:id/roles`
- `POST /api/v1/admin/users/:id/roles` `{ &quot;role&quot;: &quot;moderator&quot; }`
- `DELETE /api/v1/admin/users/:id/roles/:role`

All admin endpoints require JWT and `admin` role.

### Local Bootstrap
- Temporary allowlist via env var: `ADMIN_USER_IDS=uuid1,uuid2`
- Use it to grant first admin, then set `is_admin` via API

## Rate Limiting

### Registration Rate Limiting
To reduce abuse in non-local environments, the registration endpoint is rate-limited.

- **Endpoint**: `POST /api/v1/auth/register`
- **Limit**: 5 requests per minute per IP
- **Enabled when**: `APP_ENV` is not `development` or `local`

### Configuration
- `APP_ENV=production` enables limiting
- `APP_ENV=development` disables limiting for local dev
- General app rate limiting (100/min/IP) still applies globally

## Scripts and Automation

Use `./leaflock.sh` for common tasks:

```bash
./leaflock.sh help
./leaflock.sh icons          # regenerate icons
./leaflock.sh railway        # bootstrap Railway backend+frontend
./leaflock.sh docker:up      # compose up -d --build
./leaflock.sh docker:down
./leaflock.sh docker:build
./leaflock.sh k8s:deploy     # wrapper for deploy-k8s.sh
./leaflock.sh health         # wrapper for health-check.sh
./leaflock.sh troubleshoot   # wrapper for troubleshoot.sh
./leaflock.sh test           # wrapper for test-automation.sh
```

### Specialized Scripts
Advanced scripts for CI or specific workflows:
- `deploy-k8s.sh`, `deploy.sh`, `deploy-docker.sh`, `deploy-from-ghcr.sh`
- `setup-docker.sh`, `setup-podman.sh`, `podman-kube-play.sh`
- `health-check.sh`, `troubleshoot.sh`, `test-automation.sh`
- `env-setup.sh`, `dev-setup.sh`, `dev-watch.sh`, `init-ssl*.sh`

**Recommendation**: Start with `leaflock.sh`. Use specialized scripts for fine-grained control or CI integration.

## Icons and Assets

LeafLock ships with a full set of favicons and PWA icons generated from the LeafLock motif.

### Assets Included
- `favicon.svg` (scalable primary icon)
- `favicon.ico` (multi-image 16/32/48)
- `favicon-16.png`, `favicon-32.png`, `favicon-48.png`, `favicon-64.png`
- `apple-touch-icon.png` (180×180)
- `icon-192.png`, `icon-512.png`
- `icon-192-maskable.png`, `icon-512-maskable.png` (safe padding for maskable PWAs)

### Regenerating Icons
If you customize branding:
```bash
node scripts/generate-icons.mjs
```

### HTML Reference
For single reference in HTML:
```html
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
```

## Testing and CI/CD

### E2E Verification Workflow
Located at `.github/workflows/e2e-verify.yml`

**What it does:**
- Runs frontend lint, typecheck, tests
- Builds and starts Postgres, Redis, backend, frontend via `docker compose`
- Waits for readiness and tests API flow (register + list notes)
- Smoke tests frontend (index + asset)
- Runs backend tests with coverage gate
- Verifies Swagger access with `ADMIN_USER_IDS` fallback, then via RBAC grant

**Admin panel in E2E:**
- Sets `VITE_ENABLE_ADMIN_PANEL=true` so the UI contains the Admin section

## Development Setup

Refer to the main `CLAUDE.md` file in the repository root for:
- Environment setup
- Development commands
- Container operations
- Technology stack details
- Required environment variables

## Contributing

When contributing to LeafLock:
1. Follow the existing code style and patterns
2. Update relevant documentation
3. Add tests for new features
4. Update API documentation if adding new endpoints
5. Test admin functionality if making admin-related changes

## Contact

For technical questions, contact `contact@leaflock.app`.
</your-user-id> </div> </article> <!-- Navigation footer --> <div class="mt-12 flex justify-between items-center p-6 bg-slate-50 dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700"> <a href="/pages/" class="flex items-center space-x-2 text-emerald-600 dark:text-emerald-400 hover:text-emerald-700 dark:hover:text-emerald-300 transition-colors duration-200"> <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path> </svg> <span>Back to Documentation</span> </a> <a href="https://github.com/RelativeSure/LeafLock" target="_blank" class="flex items-center space-x-2 text-slate-600 dark:text-slate-400 hover:text-emerald-600 dark:hover:text-emerald-400 transition-colors duration-200"> <span>View on GitHub</span> <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path> </svg> </a> </div> </div>  </main> <!-- Modern footer --> <footer class="bg-slate-900 text-slate-300 border-t border-slate-700"> <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12"> <div class="grid grid-cols-1 md:grid-cols-4 gap-8"> <!-- Brand section --> <div class="col-span-1 md:col-span-2"> <div class="flex items-center space-x-3 mb-4"> <div class="w-8 h-8 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-lg flex items-center justify-center shadow-lg"> <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path> </svg> </div> <span class="text-xl font-bold text-white">LeafLock</span> </div> <p class="text-slate-400 max-w-md">
Secure, end-to-end encrypted notes with zero-knowledge architecture. 
              Your privacy is our priority.
</p> <div class="flex items-center space-x-4 mt-4"> <a href="https://github.com/RelativeSure/LeafLock" target="_blank" class="text-slate-400 hover:text-emerald-400 transition-colors duration-200"> <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"> <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path> </svg> </a> </div> </div> <!-- Documentation links --> <div> <h3 class="text-white font-semibold mb-4">Legal & Privacy</h3> <ul class="space-y-2"> <li><a href="/pages/privacy-policy/" class="text-slate-400 hover:text-emerald-400 transition-colors duration-200">Privacy Policy</a></li> <li><a href="/pages/terms-of-use/" class="text-slate-400 hover:text-emerald-400 transition-colors duration-200">Terms of Use</a></li> <li><a href="/pages/gdpr-compliance/" class="text-slate-400 hover:text-emerald-400 transition-colors duration-200">GDPR Compliance</a></li> </ul> </div> <!-- Admin links --> <div> <h3 class="text-white font-semibold mb-4">Administration</h3> <ul class="space-y-2"> <li><a href="/pages/admin-guide/" class="text-slate-400 hover:text-emerald-400 transition-colors duration-200">Admin Guide</a></li> <li><a href="/pages/monitoring-and-backups/" class="text-slate-400 hover:text-emerald-400 transition-colors duration-200">Monitoring & Backups</a></li> <li><a href="/pages/developer-guide/" class="text-slate-400 hover:text-emerald-400 transition-colors duration-200">Developer Guide</a></li> </ul> </div> </div> <!-- Bottom section --> <div class="border-t border-slate-700 mt-12 pt-8 flex flex-col md:flex-row justify-between items-center"> <p class="text-slate-400 text-sm">
© 2025 LeafLock. All rights reserved.
</p> <div class="flex items-center space-x-6 mt-4 md:mt-0"> <span class="text-slate-500 text-sm">Made with</span> <div class="flex items-center space-x-2"> <svg class="w-5 h-5 text-emerald-400" fill="currentColor" viewBox="0 0 24 24"> <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path> </svg> <span class="text-emerald-400 font-medium">AstroJS</span> </div> </div> </div> </div> </footer> <!-- Mobile menu script --> <script type="module">document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("mobile-menu-button"),n=document.getElementById("mobile-menu");e?.addEventListener("click",function(){n?.classList.toggle("hidden")})});</script> <!-- Schema.org structured data --> <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "LeafLock Documentation",
      "description": "Secure, end-to-end encrypted notes with zero-knowledge architecture",
      "url": "https://docs.leaflock.app/"
    }
    </script> </body> </html>